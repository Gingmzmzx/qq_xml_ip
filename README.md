<h1>qq_xml_ip</h1>
通过QQ的xml卡片进行ip探测

- ~~因为现版本qq安全性更新导致伪造分享卡片的软件不能用了，所以用此方法需要配合xml代码转卡片的模块或者机器人使用~~（1.0 Beta版本改进）

- 启发：来自qq机器人的"谁在窥屏"功能
- 原理：利用qq加载xml卡片消息会自动访问xml卡片中的图片地址

- 注意：① 此方法获取的ip可能多达数个，注意区分腾讯服务器ip和真实目标ip。多余ip通常有三个，ua分别为myop/1.0，本机ua及无ua的三台设备，第一个为腾讯自动将图片转换短链时获取到的服务器ip，第二个为分享给好友时自己的手机会预览图片获取到的ip，第三个为分享给好友时消息记录漫游获取到的腾讯服务器ip，除了这三个，有时还会出现一个ua为iphone使用qq6.2.5的服务器ip，除去这几个，最后获取的ip即为目标的ip。

- 注意：② ~~qq的缓存问题，同一个链接对一个目标短时间内只能生效一次，具体原因不多作解释~~(1.0版本改进)
<h2>版本：</h2>

**0.1 RC** 通过qq机器人或者转xml卡片插件发送ip探测卡片。

**1.0 Beta** 不需要再使用转卡片模块，可通过iptest.html页面，在qq内打开，直接分享给对方xml卡片。此方法需要在iptest.php后跟一堆随机无效参数才行，若不带参数会被qq直接转换成图床链接，暂时还未清楚原因(注意:IOS端无法通过此方法发送卡片)。

**1.0 RC** 将原来的ip.html更换为php文件，可通过改变get参数达到自行更新链接缓存的作用，有效解决了qq的缓存问题，无需再实时在服务器上更改文件名，只需更改 “www.test.com/iptest.php?id=参数” 中的id参数即可生成以id参数为名的记录文件，经测试id参数需在六位及以上才会被正常转换为探测链接，反之会转换为图床链接。

注: 由于腾讯服务器审查加严，参数比如以图片后缀结尾，例如 `www.test.com/iptest.php?id=test.png` 或 `www.test.com/iptest.php?id=test.jpg` 等，否则 xml 消息可能发送失败。详见 Issue #1。

### 其他方法
通过代理让你的朋友点击链接即可获取到朋友的IP
1. 利用搭载的服务器组合跳转网址，比如 http://xxxxx/getIPs?stamp=1599747195541&newUrl=[一些新闻的链接等]。
2. 最好利用短网址进行转化，这样不容易看出来问题。
3. 等你朋友访问后，通过 http://xxxxx/getIPs/list/1599747195541 来获取到你朋友的IP。
4. 注意这里的IP会有很多个，原因时因为腾讯会对你发送的连接进行检测，你只需要取最后一个即为你朋友的IP。

### 解决QQxml中图片被腾讯屏蔽问题
有时候QQ会对图片来源进行判定，如果非白名单域名则不进行解析，为解决这一问题，可以选择QQ浏览器代理服务器进行代理访问。
即 用http://read.html5.qq.com/image?src=share&t=0&imageUrl=[URL编码的图片连接] 来包裹你的图片，这样即可被QQ客户端认可。
